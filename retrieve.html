<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retrieve</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
        integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="style.css" />

        <style>
            .labs{
                display: inline-block;
                width: 100px;
            }
        </style>
    </head>


<body>
    <h1 class="title">NFC MTC GRAB REG</h1>
    <img src="logo.jpg" alt="MTC GRAB" class="pic">
    
    <div class="container mt-3">
        
        <div class="input-group mb-3">
            <input id="SearchBar" type="text" class="form-control" placeholder="Search using the" aria-label="Recipient's username" aria-describedby="button-addon2">
            <div class="input-group-append">
                <select class="custom-select" id="CategorySelected">
                    <option selected value="1">name</option>
                    <option value="2">username</option>
                    <option value="3"> email</option>
                    <option value="4"> password</option>
                  </select>
              <button id="SearchBtn" class="ml-1 btn btn-outline-primary" type="button" id="button-addon2">SEARCH</button>
            </div>
          </div>
<a href="index.html" class="btn btn-primary btn-lg" tabindex="-1" role="button" aria-disabled="false">Return</a>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<a href="register.html" class="btn btn-primary btn-lg" tabindex="-1" role="button" aria-disabled="false">Add User</a>
        <table class="table table-dark" id="myTable">
             <thead class="thead-dark">
                <th>Sno</th>
                <th>Full Name</th>
                <th>Username</th>
                <th>email</th>
                <th>password</th>
                <th>Control Center</th>

            </thead>
            <tbody  id="tbody1">
                


    </div>
  <!-- Modal -->
  <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalCenterTitle">Control Pannel</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <label class="labs">Full name:  </label>
          <input type="text" id="NameMod"> <br>
          <label class="labs">Username:  </label>
          <input type="text" id="RollMod"> <br>
          <label class="labs">Email:  </label>
          <input type="text" id="SecMod"> <br>
          <label class="labs">Password:  </label>
          <input type="text" id="PassMod"> <br>
        </div>
        <div class="modal-footer">
          <button id="AddModBtn" type="button" class="btn btn-primary"  onclick="Addstd()" >Add</button>
          <button  id="UpdModBtn" type="button" class="btn btn-success" onclick="Updstd()">Update</button>
          <button  id="DelModBtn" type="button" class="btn btn-danger" onclick="Delstd()">Delete</button>
        </div>
      </div>
    </div>
  </div>
  
</tbody>
</table>

  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script type="module">
        var stdNo = 0; 
        var stdList =[];
        var tbody = document.getElementById('tbody1');
        function AddItemToTable(fullname,username,email,password) {
            let tr = document.createElement("tr");
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');
            let td5 = document.createElement('td');

            stdList.push([fullname,username,email,password]);
            td1.innerHTML = ++stdNo;
            td2.innerHTML = fullname;
            td3.innerHTML = username;
            td4.innerHTML = email;
            td5.innerHTML = password;
           
            td2 .classList +="nameField";
            td3.classList +="dateField";
            td4.classList +="timeField";
            td5.classList +="phoneField";
            tr.appendChild(td1);
            tr.appendChild(td2);
            tr.appendChild(td3);
            tr.appendChild(td4);
            tr.appendChild(td5);
            var ControlDiv = document.createElement("div");
           
            ControlDiv.innerHTML = '<button  id="btnsave" type="button"  class="btn btn-primary my-2 ml-2" data-toggle="modal" data-target="#exampleModalCenter" onclick = "FillTboxes('+stdNo+')"> Edit </button>';

            tr.appendChild(ControlDiv);
            tbody.appendChild(tr);
        }  

        var ModName = document.getElementById('NameMod');
        var ModRoll = document.getElementById('RollMod');
        var ModSec = document.getElementById('SecMod');
        var ModPass = document.getElementById('PassMod');
       
        var BTNmodAdd = document.getElementById('AddModBtn');
        var BTNmodUpd = document.getElementById('UpdModBtn');
        var BTNmodDel = document.getElementById('DelModBtn');

         function FillTboxes (index){
                if(index==null){
                    ModName.value = "";
                    ModRoll.value = "";
                    ModSec.value = "";
                    ModPass.value = "";
                    BTNmodAdd.style.display='inline-block';
                    BTNmodUpd.style.display='none';
                    BTNmodDel.style.display='none';

                   
                }
                else{
                    --index;
                    ModName.value = stdList[index][0];
                    ModRoll.value = stdList[index][1];
                    ModSec.value = stdList[index][2];
                    ModPass.value = stdList[index][3];
                    ModRoll.disabled = true;
                    BTNmodAdd.style.display='none';
                    BTNmodUpd.style.display='inline-block';
                    BTNmodDel.style.display='inline-block';
                    
                    
                }
        }
       
        function Delstd(){
            firebase.database().ref("UsersList/"+ModRoll.value).remove().then({
                function(){
                    alert("record deleted");
                    GetAllDataOnce();
                    $("#exampleModalCenter").modal("hide");
                }
            })
        }
        function AddAllItemsToTable(TheStudent) {
            stdNo = 0;
            tbody.innerHTML = "";
            TheStudent.forEach(element => {
                AddItemToTable(element.fullname, element.username, element.email,element.password );
            });
        }
       
  
 //............................................gettign data........................//
                    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
                    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";

                    const firebaseConfig = {
                        apiKey: "AIzaSyDmlZRJLhYLTlD2-PpXa0Pay8cjMFmEDpM",
                        authDomain: "form-5423e.firebaseapp.com",
                        databaseURL: "https://form-5423e-default-rtdb.firebaseio.com",
                        projectId: "form-5423e",
                        storageBucket: "form-5423e.appspot.com",
                        messagingSenderId: "666727433742",
                        appId: "1:666727433742:web:22adeaad52d23eadc4de5f",
                        measurementId: "G-GCK8MQSTKN"
                    };

                    // Initialize Firebase
                    const app = initializeApp(firebaseConfig);

                    import  {getDatabase, ref , child, onValue, get}
                    from  "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
                
                   const db = getDatabase();
                
                
                    function GetAllDataOnce(){
                    const dbref = ref(db);

                    get(child(dbref, "UsersList"))
                    .then((snapshot)=>{

                        var students =[];
                        snapshot.forEach(childSnapshot =>{
                            students.push(childSnapshot.val());
                        });

                        AddAllItemsToTable(students);
                    });
            }

            window.onload = GetAllDataOnce;


            var searchBar = document.getElementById("SearchBar");
            var searchBtn = document.getElementById("SearchBtn");
            var category = document.getElementById("CategorySelected");
            var tbody = document.getElementById("tbody1");

            function SearchTable(Category){

                var filter = searchBar.value.toUpperCase();
                var tr = tbody.getElementsByTagName("tr");
                var found;

                for (let i = 0; i < tr.length; i++) {
                    var td = tr[i].getElementsByClassName(Category);
                    
                    for ( let j = 0;  j < td.length; j++) {
                        if(td[j].innerHTML.toUpperCase().indexOf(filter) > -1){
                            found=true;
                        }
                        
                    }

                    if(found){
                        tr[i].style.display="";
                        found=false;

                    }
                    else{
                        tr[i].style.display="none";
                    }
                }

            }

            searchBtn.onclick = function(){
                if(searchBar.value==""){
                    SearchTable("nameField");
                }

                else if(category.value==1)
                SearchTable("nameField");

                else if(category.value==2)
                SearchTable("dateField");

                else if(category.value==3)
                SearchTable("timeField");

                else if(category.value==4)
                SearchTable("phoneField");
            };
           
    </script>

</body>

</html>